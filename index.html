<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LVMH Digital Card Dashboard</title>
    <style>
        :root{
            --bg:#0b1222; --card:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
            --acc:#60a5fa; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --line:#1f2937;
        }
        * { box-sizing: border-box; }
        body { 
            font-family: Inter, system-ui, Arial; 
            background: #0b1222; 
            margin: 0; 
            padding: 20px;
            color: var(--ink);
        }
        .dashboard { 
            max-width: 1600px; 
            margin: 0 auto; 
            display: grid; 
            gap: 20px; 
            grid-template-columns: 450px 1fr;
        }
        .panel { 
            background: linear-gradient(180deg, #0f172a 0%, #111827 100%); 
            border: 1px solid #1f2937; 
            border-radius: 16px; 
            padding: 20px; 
            box-shadow: 0 16px 40px rgba(0,0,0,.35);
            max-height: 95vh;
            overflow-y: auto;
        }
        .panel h2 { 
            margin: 0 0 16px 0; 
            color: #60a5fa; 
            font-size: 18px; 
            font-weight: 700;
        }
        .input-group { 
            margin-bottom: 16px; 
        }
        .input-group label { 
            display: block; 
            margin-bottom: 6px; 
            font-size: 13px; 
            font-weight: 500; 
            color: #cbd5e1;
        }
        .input-group input, .input-group select { 
            width: 100%; 
            padding: 8px 12px; 
            background: #1e293b; 
            border: 1px solid #374151; 
            border-radius: 8px; 
            color: #e5e7eb; 
            font-size: 14px;
        }
        .input-group input:focus, .input-group select:focus { 
            outline: none; 
            border-color: #60a5fa; 
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        .customer-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 10px 0;
            font-size: 13px;
        }
        .customer-table th {
            background: #0b1222;
            color: #cbd5e1;
            padding: 8px 6px;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border-bottom: 1px solid var(--line);
            text-align: center;
        }
        .customer-table td {
            padding: 4px 2px;
            text-align: center;
        }
        .customer-table input {
            width: 100%;
            padding: 4px 6px;
            background: #1e293b;
            border: 1px solid #374151;
            border-radius: 4px;
            color: #e5e7eb;
            font-size: 12px;
            text-align: center;
        }
        .customer-table input:focus {
            outline: none;
            border-color: #60a5fa;
        }
        .segment-section {
            background: #0e162a;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .segment-title {
            font-size: 16px;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 10px;
        }
        .kpi-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-bottom: 20px;
        }
        .kpi { 
            padding: 16px; 
            border-radius: 12px; 
            text-align: center; 
            color: white;
        }
        .kpi .label { 
            font-size: 11px; 
            font-weight: 700; 
            letter-spacing: 0.05em; 
            opacity: 0.9; 
            margin-bottom: 4px;
        }
        .kpi .value { 
            font-size: 22px; 
            font-weight: 900;
        }
        .kpi.blue { background: linear-gradient(135deg, #1d4ed8, #60a5fa); }
        .kpi.green { background: linear-gradient(135deg, #047857, #34d399); }
        .kpi.gold { background: linear-gradient(135deg, #92400e, #f59e0b); }
        .kpi.purple { background: linear-gradient(135deg, #6d28d9, #a78bfa); }
        .table-container { 
            overflow-x: auto; 
            margin-top: 20px;
        }
        table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0; 
            font-size: 14px;
        }
        th { 
            background: #0b1222; 
            color: #cbd5e1; 
            padding: 12px; 
            font-weight: 700; 
            font-size: 12px; 
            text-transform: uppercase; 
            letter-spacing: 0.04em; 
            border-bottom: 1px solid var(--line);
        }
        td { 
            padding: 10px 12px; 
            border-bottom: 1px solid #1f2937; 
            color: #e2e8f0; 
            text-align: center;
        }
        tr:nth-child(even) td { background: #0e162a; }
        .positive { color: #34d399; font-weight: 700; }
        .negative { color: #ef4444; font-weight: 700; }
        .highlight { background: #1e3a8a !important; }
        .chart-container { 
            height: 300px; 
            margin-top: 20px; 
            position: relative;
        }
        .reset-btn { 
            background: #374151; 
            color: white; 
            border: none; 
            padding: 10px 16px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            margin-top: 10px; 
            width: 100%;
        }
        .reset-btn:hover { background: #4b5563; }
        .status { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #10b981; 
            color: white; 
            padding: 8px 16px; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="status">âœ… Dashboard lÃ¤uft</div>
    
    <div class="dashboard">
        <div class="panel">
            <h2>ðŸ“Š Parameter</h2>
            
            <div class="input-group">
                <label>Initial CapEx (Mio. â‚¬)</label>
                <input type="number" id="initial_capex" value="18" step="0.5">
            </div>
            
            <div class="input-group">
                <label>WACC / Discount Rate (%)</label>
                <input type="number" id="discount" value="10" step="0.5">
            </div>
            
            <div class="input-group">
                <label>Steuersatz (%)</label>
                <input type="number" id="tax" value="28" step="1">
            </div>
            
            <div class="input-group">
                <label>Fixe OpEx (Mio. â‚¬/Jahr)</label>
                <input type="number" id="fix_opex" value="6" step="0.5">
            </div>
            
            <div class="input-group">
                <label>Net Revenue Rate (%)</label>
                <input type="number" id="rev_rate" value="0.65" step="0.05">
            </div>
            
            <div class="input-group">
                <label>Data Revenue (Mio. â‚¬/Jahr ab J3)</label>
                <input type="number" id="data_revenue" value="3" step="0.5">
            </div>

            <div class="segment-section">
                <div class="segment-title">ðŸŽ¯ UHNW Segment</div>
                
                <div class="input-group">
                    <label>UHNW CAC (â‚¬)</label>
                    <input type="number" id="uhnw_cac" value="900" step="50">
                </div>
                
                <div class="input-group">
                    <label>UHNW Fee (â‚¬/Jahr)</label>
                    <input type="number" id="uhnw_fee" value="5000" step="100">
                </div>
                
                <div class="input-group">
                    <label>UHNW Churn Rate (%)</label>
                    <input type="number" id="uhnw_churn" value="8" step="0.5">
                </div>

                <label>UHNW Kunden pro Jahr:</label>
                <table class="customer-table">
                    <tr>
                        <th>J0</th><th>J1</th><th>J2</th><th>J3</th><th>J4</th><th>J5</th><th>J6</th><th>J7</th>
                    </tr>
                    <tr>
                        <td><input type="number" id="uhnw_0" value="200" step="50"></td>
                        <td><input type="number" id="uhnw_1" value="600" step="50"></td>
                        <td><input type="number" id="uhnw_2" value="1200" step="50"></td>
                        <td><input type="number" id="uhnw_3" value="2000" step="50"></td>
                        <td><input type="number" id="uhnw_4" value="3000" step="50"></td>
                        <td><input type="number" id="uhnw_5" value="3500" step="50"></td>
                        <td><input type="number" id="uhnw_6" value="3800" step="50"></td>
                        <td><input type="number" id="uhnw_7" value="4000" step="50"></td>
                    </tr>
                </table>
            </div>

            <div class="segment-section">
                <div class="segment-title">ðŸ’³ Undiscovered Segment</div>
                
                <div class="input-group">
                    <label>Undiscovered CAC (â‚¬)</label>
                    <input type="number" id="undiscovered_cac" value="400" step="25">
                </div>
                
                <div class="input-group">
                    <label>Undiscovered Fee (â‚¬/Jahr)</label>
                    <input type="number" id="undiscovered_fee" value="1200" step="50">
                </div>
                
                <div class="input-group">
                    <label>Undiscovered Churn Rate (%)</label>
                    <input type="number" id="undiscovered_churn" value="18" step="0.5">
                </div>

                <label>Undiscovered Kunden pro Jahr:</label>
                <table class="customer-table">
                    <tr>
                        <th>J0</th><th>J1</th><th>J2</th><th>J3</th><th>J4</th><th>J5</th><th>J6</th><th>J7</th>
                    </tr>
                    <tr>
                        <td><input type="number" id="undiscovered_0" value="0" step="100"></td>
                        <td><input type="number" id="undiscovered_1" value="800" step="100"></td>
                        <td><input type="number" id="undiscovered_2" value="2000" step="100"></td>
                        <td><input type="number" id="undiscovered_3" value="6000" step="100"></td>
                        <td><input type="number" id="undiscovered_4" value="10000" step="100"></td>
                        <td><input type="number" id="undiscovered_5" value="14000" step="100"></td>
                        <td><input type="number" id="undiscovered_6" value="17000" step="100"></td>
                        <td><input type="number" id="undiscovered_7" value="20000" step="100"></td>
                    </tr>
                </table>
            </div>
            
            <button class="reset-btn" onclick="resetToDefaults()">ðŸ”„ ZurÃ¼cksetzen</button>
        </div>
        
        <div>
            <div class="panel">
                <h2>ðŸ“ˆ Key Performance Indicators</h2>
                <div class="kpi-grid">
                    <div class="kpi blue">
                        <div class="label">NPV (7 Jahre)</div>
                        <div class="value" id="npv-value">â‚¬54,2M</div>
                    </div>
                    <div class="kpi green">
                        <div class="label">IRR</div>
                        <div class="value" id="irr-value">28,3%</div>
                    </div>
                    <div class="kpi gold">
                        <div class="label">Break-even</div>
                        <div class="value" id="be-value">J4</div>
                    </div>
                    <div class="kpi purple">
                        <div class="label">FCF Jahr 7</div>
                        <div class="value" id="fcf-value">â‚¬25,1M</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="cashFlowChart" width="800" height="300"></canvas>
                </div>
            </div>
            
            <div class="panel">
                <h2>ðŸ’° Finanzprojektion</h2>
                <div class="table-container">
                    <table id="financial-table">
                        <thead>
                            <tr>
                                <th>Jahr</th>
                                <th>UHNW Kunden</th>
                                <th>Undiscovered Kunden</th>
                                <th>Total Kunden</th>
                                <th>Revenue (Mâ‚¬)</th>
                                <th>EBITDA (Mâ‚¬)</th>
                                <th>FCF (Mâ‚¬)</th>
                                <th>Kum. FCF (Mâ‚¬)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0,0</td>
                                <td>0,0</td>
                                <td class="negative">-18,0</td>
                                <td class="negative">-18,0</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>800</td>
                                <td>5,1</td>
                                <td class="negative">-2,1</td>
                                <td class="negative">-2,2</td>
                                <td class="negative">-20,2</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2.800</td>
                                <td>16,0</td>
                                <td>8,2</td>
                                <td>7,6</td>
                                <td class="negative">-12,6</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>8.000</td>
                                <td>44,9</td>
                                <td>33,9</td>
                                <td>31,6</td>
                                <td class="positive">19,0</td>
                            </tr>
                            <tr class="highlight">
                                <td>4</td>
                                <td>13.000</td>
                                <td>70,5</td>
                                <td>57,3</td>
                                <td>53,2</td>
                                <td class="positive">72,2</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>17.500</td>
                                <td>93,5</td>
                                <td>78,8</td>
                                <td>73,2</td>
                                <td class="positive">145,4</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>20.800</td>
                                <td>110,3</td>
                                <td>95,0</td>
                                <td>88,1</td>
                                <td class="positive">233,5</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>24.000</td>
                                <td>126,5</td>
                                <td>109,5</td>
                                <td>101,5</td>
                                <td class="positive">335,0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Financial calculation functions
        function npv(rate, cashflows) {
            return cashflows.reduce((sum, cf, t) => sum + cf / Math.pow(1 + rate, t), 0);
        }
        
        function irrBisection(cashflows, lo = -0.99, hi = 5.0, tol = 1e-7, maxIter = 200) {
            function f(r) { return npv(r, cashflows); }
            let fLo = f(lo);
            let fHi = f(hi);
            
            if (fLo * fHi > 0) return NaN;
            
            for (let i = 0; i < maxIter; i++) {
                let mid = (lo + hi) / 2;
                let val = f(mid);
                
                if (Math.abs(val) < tol) return mid;
                
                if (fLo * val < 0) {
                    hi = mid;
                    fHi = val;
                } else {
                    lo = mid;
                    fLo = val;
                }
            }
            return (lo + hi) / 2;
        }
        
        function formatMoney(value) {
            return `â‚¬${(value / 1e6).toFixed(1)}M`.replace('.', ',');
        }
        
        function getInputs() {
            return {
                initial_capex: parseFloat(document.getElementById('initial_capex').value) * 1e6,
                discount: parseFloat(document.getElementById('discount').value) / 100,
                tax: parseFloat(document.getElementById('tax').value) / 100,
                fix_opex: parseFloat(document.getElementById('fix_opex').value) * 1e6,
                uhnw_cac: parseFloat(document.getElementById('uhnw_cac').value),
                uhnw_fee: parseFloat(document.getElementById('uhnw_fee').value),
                uhnw_churn: parseFloat(document.getElementById('uhnw_churn').value) / 100,
                undiscovered_cac: parseFloat(document.getElementById('undiscovered_cac').value),
                undiscovered_fee: parseFloat(document.getElementById('undiscovered_fee').value),
                undiscovered_churn: parseFloat(document.getElementById('undiscovered_churn').value) / 100,
                rev_rate: parseFloat(document.getElementById('rev_rate').value) / 100,
                data_revenue: parseFloat(document.getElementById('data_revenue').value) * 1e6,
                // Customer numbers for each year
                uhnw_customers: [
                    parseFloat(document.getElementById('uhnw_0').value),
                    parseFloat(document.getElementById('uhnw_1').value),
                    parseFloat(document.getElementById('uhnw_2').value),
                    parseFloat(document.getElementById('uhnw_3').value),
                    parseFloat(document.getElementById('uhnw_4').value),
                    parseFloat(document.getElementById('uhnw_5').value),
                    parseFloat(document.getElementById('uhnw_6').value),
                    parseFloat(document.getElementById('uhnw_7').value)
                ],
                undiscovered_customers: [
                    parseFloat(document.getElementById('undiscovered_0').value),
                    parseFloat(document.getElementById('undiscovered_1').value),
                    parseFloat(document.getElementById('undiscovered_2').value),
                    parseFloat(document.getElementById('undiscovered_3').value),
                    parseFloat(document.getElementById('undiscovered_4').value),
                    parseFloat(document.getElementById('undiscovered_5').value),
                    parseFloat(document.getElementById('undiscovered_6').value),
                    parseFloat(document.getElementById('undiscovered_7').value)
                ]
            };
        }
        
        function runCalculation() {
            const inputs = getInputs();
            
            const results = [];
            let cumCF = -inputs.initial_capex;
            let prevRev = 0;
            
            for (let year = 0; year <= 7; year++) {
                if (year === 0) {
                    results.push({
                        year: 0,
                        customers: 0,
                        revenue: 0,
                        ebitda: 0,
                        fcf: -inputs.initial_capex,
                        cumFcf: cumCF
                    });
                    continue;
                }
                
                // Get customer numbers directly from inputs
                const uhnw_active = inputs.uhnw_customers[year];
                const undiscovered_active = inputs.undiscovered_customers[year];
                const total_customers = uhnw_active + undiscovered_active;
                
                // Calculate new customers (simplified)
                const uhnw_prev = year > 0 ? inputs.uhnw_customers[year - 1] : 0;
                const undiscovered_prev = year > 0 ? inputs.undiscovered_customers[year - 1] : 0;
                
                const uhnw_retained = Math.round(uhnw_prev * (1 - inputs.uhnw_churn));
                const undiscovered_retained = Math.round(undiscovered_prev * (1 - inputs.undiscovered_churn));
                
                const uhnw_new = Math.max(0, uhnw_active - uhnw_retained);
                const undiscovered_new = Math.max(0, undiscovered_active - undiscovered_retained);
                
                const total_cac = uhnw_new * inputs.uhnw_cac + undiscovered_new * inputs.undiscovered_cac;
                
                // Revenue calculation
                const uhnw_card_rev = uhnw_active * 120000 * inputs.rev_rate;
                const undiscovered_card_rev = undiscovered_active * 45000 * inputs.rev_rate;
                const uhnw_fee_rev = uhnw_active * inputs.uhnw_fee;
                const undiscovered_fee_rev = undiscovered_active * inputs.undiscovered_fee;
                const data_rev = year >= 3 ? inputs.data_revenue : 0;
                
                const total_revenue = uhnw_card_rev + undiscovered_card_rev + uhnw_fee_rev + undiscovered_fee_rev + data_rev;
                
                // Variable OpEx
                const var_opex = total_customers * 200;
                
                // EBITDA
                const ebitda = total_revenue - inputs.fix_opex - var_opex - total_cac;
                
                // CapEx and Working Capital
                const capex_run = total_revenue * 0.01;
                const delta_wc = Math.max(0, (total_revenue - prevRev) * 0.03);
                prevRev = total_revenue;
                
                // Tax (only on positive EBIT)
                const tax = Math.max(0, ebitda * inputs.tax);
                
                // FCF
                const fcf = ebitda - tax - capex_run - delta_wc;
                cumCF += fcf;
                
                results.push({
                    year,
                    customers: total_customers,
                    revenue: total_revenue,
                    ebitda,
                    fcf,
                    cumFcf: cumCF
                });
            }
            
            // Calculate KPIs
            const cashflows = results.map(r => r.fcf);
            const npvValue = npv(inputs.discount, cashflows);
            const irrValue = irrBisection(cashflows);
            const breakeven = results.findIndex(r => r.cumFcf >= 0);
            const fcfY7 = results[7].fcf;
            
            return {
                results,
                kpis: {
                    npv: npvValue,
                    irr: irrValue,
                    breakeven: breakeven > 0 ? breakeven : null,
                    fcfY7
                }
            };
        }
        
        function updateDisplay() {
            const { results, kpis } = runCalculation();
            
            // Update KPIs
            document.getElementById('npv-value').textContent = formatMoney(kpis.npv);
            document.getElementById('irr-value').textContent = isNaN(kpis.irr) ? 'â€”' : `${(kpis.irr * 100).toFixed(1)}%`.replace('.', ',');
            document.getElementById('be-value').textContent = kpis.breakeven ? `J${kpis.breakeven}` : 'n.a.';
            document.getElementById('fcf-value').textContent = formatMoney(kpis.fcfY7);
            
            // Update table
            const tbody = document.querySelector('#financial-table tbody');
            tbody.innerHTML = '';
            
            const inputs = getInputs(); // Get inputs to access customer numbers
            
            results.forEach((row, index) => {
                const tr = document.createElement('tr');
                if (row.year === 4) tr.classList.add('highlight');
                
                // Get segment-specific customer numbers
                const uhnw_cust = row.year === 0 ? 0 : inputs.uhnw_customers[row.year];
                const undiscovered_cust = row.year === 0 ? 0 : inputs.undiscovered_customers[row.year];
                
                tr.innerHTML = `
                    <td>${row.year}</td>
                    <td>${uhnw_cust.toLocaleString('de-DE')}</td>
                    <td>${undiscovered_cust.toLocaleString('de-DE')}</td>
                    <td>${row.customers.toLocaleString('de-DE')}</td>
                    <td>${(row.revenue / 1e6).toFixed(1).replace('.', ',')}</td>
                    <td>${(row.ebitda / 1e6).toFixed(1).replace('.', ',')}</td>
                    <td class="${row.fcf >= 0 ? 'positive' : 'negative'}">${(row.fcf / 1e6).toFixed(1).replace('.', ',')}</td>
                    <td class="${row.cumFcf >= 0 ? 'positive' : 'negative'}">${(row.cumFcf / 1e6).toFixed(1).replace('.', ',')}</td>
                `;
                tbody.appendChild(tr);
            });
            
            // Update chart
            updateChart(results);
        }
        
        function updateChart(results) {
            const canvas = document.getElementById('cashFlowChart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Find data bounds
            const fcfValues = results.map(r => r.fcf / 1e6);
            const cumValues = results.map(r => r.cumFcf / 1e6);
            const minY = Math.min(...fcfValues, ...cumValues);
            const maxY = Math.max(...fcfValues, ...cumValues);
            const rangeY = maxY - minY;
            
            // Draw grid and axes
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + chartHeight);
            ctx.stroke();
            
            // X-axis
            ctx.beginPath();
            ctx.moveTo(padding, padding + chartHeight);
            ctx.lineTo(padding + chartWidth, padding + chartHeight);
            ctx.stroke();
            
            // Zero line
            if (minY < 0 && maxY > 0) {
                const zeroY = padding + chartHeight - (-minY / rangeY * chartHeight);
                ctx.strokeStyle = '#6b7280';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(padding, zeroY);
                ctx.lineTo(padding + chartWidth, zeroY);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Draw FCF bars
            ctx.fillStyle = '#60a5fa';
            const barWidth = chartWidth / results.length * 0.4;
            
            results.forEach((row, i) => {
                const x = padding + (i / (results.length - 1)) * chartWidth - barWidth / 2;
                const value = row.fcf / 1e6;
                const height = Math.abs(value) / rangeY * chartHeight;
                const y = value >= 0 ? 
                    padding + chartHeight - (-minY / rangeY * chartHeight) - height :
                    padding + chartHeight - (-minY / rangeY * chartHeight);
                
                ctx.fillRect(x, y, barWidth, height);
            });
            
            // Draw cumulative FCF line
            ctx.strokeStyle = '#34d399';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            results.forEach((row, i) => {
                const x = padding + (i / (results.length - 1)) * chartWidth;
                const y = padding + chartHeight - ((row.cumFcf / 1e6 - minY) / rangeY * chartHeight);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#e5e7eb';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            
            // X-axis labels (years)
            results.forEach((row, i) => {
                const x = padding + (i / (results.length - 1)) * chartWidth;
                ctx.fillText(`J${row.year}`, x, canvas.height - 20);
            });
            
            // Y-axis labels
            ctx.textAlign = 'right';
            const steps = 5;
            for (let i = 0; i <= steps; i++) {
                const value = minY + (rangeY * i / steps);
                const y = padding + chartHeight - (i / steps * chartHeight);
                ctx.fillText(`${value.toFixed(1)}M`, padding - 10, y + 4);
            }
            
            // Legend
            ctx.font = '14px Inter';
            ctx.fillStyle = '#60a5fa';
            ctx.fillRect(padding + 20, padding + 20, 15, 15);
            ctx.fillStyle = '#e5e7eb';
            ctx.textAlign = 'left';
            ctx.fillText('FCF', padding + 40, padding + 32);
            
            ctx.strokeStyle = '#34d399';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding + 100, padding + 27);
            ctx.lineTo(padding + 115, padding + 27);
            ctx.stroke();
            ctx.fillText('Kum. FCF', padding + 120, padding + 32);
        }
        
        function resetToDefaults() {
            document.getElementById('initial_capex').value = '18';
            document.getElementById('discount').value = '10';
            document.getElementById('tax').value = '28';
            document.getElementById('fix_opex').value = '6';
            document.getElementById('rev_rate').value = '0.65';
            document.getElementById('data_revenue').value = '3';
            
            document.getElementById('uhnw_cac').value = '900';
            document.getElementById('uhnw_fee').value = '5000';
            document.getElementById('uhnw_churn').value = '8';
            
            document.getElementById('undiscovered_cac').value = '400';
            document.getElementById('undiscovered_fee').value = '1200';
            document.getElementById('undiscovered_churn').value = '18';
            
            // Reset customer numbers
            document.getElementById('uhnw_0').value = '200';
            document.getElementById('uhnw_1').value = '600';
            document.getElementById('uhnw_2').value = '1200';
            document.getElementById('uhnw_3').value = '2000';
            document.getElementById('uhnw_4').value = '3000';
            document.getElementById('uhnw_5').value = '3500';
            document.getElementById('uhnw_6').value = '3800';
            document.getElementById('uhnw_7').value = '4000';
            
            document.getElementById('undiscovered_0').value = '0';
            document.getElementById('undiscovered_1').value = '800';
            document.getElementById('undiscovered_2').value = '2000';
            document.getElementById('undiscovered_3').value = '6000';
            document.getElementById('undiscovered_4').value = '10000';
            document.getElementById('undiscovered_5').value = '14000';
            document.getElementById('undiscovered_6').value = '17000';
            document.getElementById('undiscovered_7').value = '20000';
            
            updateDisplay();
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updateDisplay);
            });
            
            // Initial load with default values
            updateDisplay();
        });
    </script>
</body>
</html>
           
